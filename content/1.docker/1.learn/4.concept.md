# 4. 基本概念

1. **镜像(Image)：** 类似于虚拟机中的镜像，是一个包含有文件系统的面向Docker引擎的只读模板。任何应用程序运行都需要环境，而镜像就是用来提供这种运行环境的。例如一个CentOS镜像就是一个包含CentOS操作系统环境的模板，同理在该镜像上装上Node软件，就可以称为Node镜像。镜像是由一系列的层叠而成的，每一层都对应一个Dockerfile指令。镜像是Docker的核心概念，Docker的其他所有概念都是围绕着镜像展开的。
2. **容器(Container)：** 类似于一个轻量级的沙盒，可以将其看作一个极简的Linux系统环境（包括root权限、进程空间、用户空间和网络空间等），以及运行在其中的应用程序。Docker引擎利用容器来运行、隔离各个应用。容器是镜像创建的应用实例，可以创建、启动、停止、删除容器，各个容器之间是是相互隔离的，互不影响。注意：镜像本身是只读的，容器从镜像启动时，Docker在镜像的上层创建一个可写层，镜像本身不变。
3. **仓库(Repository)：** 类似于Github代码仓库，是Docker用来集中存放镜像文件的地方。注意与注册服务器（Registry）的区别：注册服务器是存放仓库的地方，一般会有多个仓库；而仓库是存放镜像的地方，一般每个仓库存放一类镜像，每个镜像利用tag进行区分，比如Ubuntu仓库存放有多个版本（12.04、14.04等）的Ubuntu镜像。Docker Hub是Docker官方提供的一个用于托管镜像的仓库，用户可以在上面搜索、下载、上传镜像。
4. **Dockerfile：** 类似于脚本，用来从无到有构建镜像。Dockerfile是一个文本文件，其中包含了一条条构建镜像所需的指令和说明。Dockerfile中的每一条指令都会创建一个新的镜像层，并对镜像进行更新。当构建一个镜像时，Docker引擎会根据Dockerfile中的指令，从上到下逐条执行，最终生成一个新的镜像。Dockerfile中的指令分为两类：一类是构建镜像时执行的命令，如RUN、ADD、COPY等；另一类是指定镜像的元数据，如LABEL、MAINTAINER、EXPOSE等。Dockerfile中的指令不区分大小写，但最好使用大写，这样更容易区分。
5. **Docker-Compose：** 类似于docker run命令，用来从无到有构建容器。Docker-compose是单机管理，编排容器，可以同时管理多个 container的工具，通过一个YAML文件来配置应用的服务。使用Docker-compose，可以将多个容器组合成一个应用，然后通过一个命令就可以启动所有的服务。比如运行一个jar需要依赖jdk、mysql、mq、redis等，这些容器只需要 docker-composer up 就可以全部启动，不需要一个个单独启动。但是Docker-Compose只能管理当前主机上的Docker，也就是说不能去启动其他主机上的Docker容器。
6. **Docker Swarm：** Docker Swarm 是一款用来管理多主机上的Docker容器的工具，可以负责帮你启动容器，监控容器状态，如果容器的状态不正常它会帮你重新帮你启动一个新的容器，来提供服务，同时也提供服务之间的负载均衡，而这些东西Docker-Compose 是做不到的。
7. **Kubernetes(K8s)：** Kubernetes它本身的角色定位是和Docker Swarm 是一样的，也就是说他们负责的工作在容器领域来说是相同的部分，都是一个跨主机的容器管理平台，当然也有自己一些不一样的特点，k8s是谷歌公司根据自身的多年的运维经验研发的一款容器管理平台。而Docker Swarm则是由Docker 公司研发的。
8. **集群(Cluster)：** 集群是指将多台服务器联合起来以共同完成一个任务或提供一个服务的系统。它可以用于分布式（一个业务分拆多个子业务，部署在不同的服务器上）计算、负载均衡以及高可用性等场景。即用一句话描述集群，即一堆服务器合作做同一件事，这些机器可能需要统一协调管理，可以分布在一个机房，也可以分布在全国全球各个地区的多个机房。

**镜像，容器，仓库的关系如下图所示：**
![图 1](https://s2.loli.net/2023/04/09/HG6Xsa9Fok54Ae2.png)

Docker, Docker Compose, Docker Swarm, K8s 总结如下：

Docker是容器技术的核心、基础，Docker Compose是一个基于Docker的单主机容器编排工具，而k8s是一个跨主机的集群部署工具，功能并不像Docker Swarm和Kubernetes基于Docker的跨主机的容器管理平台那么丰富。

K8s就像一个领航员，把各种集装箱（container）有条不紊地组装起来，着重提供如下功能：
1.快速部署功能：定义对应的charts，可以方便把大型的应用部署上去。
2.智能的缩扩容机制：部署时候会自动去考虑容器应该部署在哪个服务器上，以及副本的数量可以自定义。
3.自愈功能：某个节点的服务崩溃了，可以自动迁移到另外一个服务器节点来恢复来实现高可用。
4.智能的负载均衡：利用Ingress，可以实现流量通过域名访问进来时候，进行流量的分流到不同服务器上。
5.智能的滚动升降级：升级或者降级时候，会逐个替换，当自定义数量的服务升级OK后，才会进行其他的升级以及真正销毁旧的服务。

**几种技术的应用场景及资源占用情况：**
| 技术           | 应用场景              | 资源占用情况 |
| :------------- | :-------------------- | :----------- |
| Docker         | 单机部署简单应用      | 低           |
| Docker-Compose | 单机/少数机器部署应用 | 低           |
| k8s            | 集群部署高可用应用    | 高           |


**集群与分布式的关系如图：**
![图 2](https://s2.loli.net/2023/04/09/KIpo8NgaCPRufbA.png)

