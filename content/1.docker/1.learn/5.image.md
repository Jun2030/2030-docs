# 5. åˆ›å»ºé•œåƒ

## Dockeré•œåƒçš„å¸¸è§åˆ›å»ºæ–¹æ³•

1. åŸºäºå·²æœ‰é•œåƒ(å®¹å™¨)åˆ›å»º
2. åŸºäºDockerfileåˆ›å»º


### åŸºäºDockerfileåˆ›å»º
::alert{type="info"}
ğŸŒˆ æ ¸å¿ƒæ€æƒ³ï¼šç¼–å†™ Dockerfile è„šæœ¬æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨docker buildå‘½ä»¤æ¥æ„å»ºé•œåƒ
::
**æ„å»ºæ­¥éª¤ï¼š**
1. ç¼–å†™Dockerfileæ–‡ä»¶
2. docker buildå‘½ä»¤æ„å»ºé•œåƒ
3. docker runå‘½ä»¤è¿è¡Œå®¹å™¨
4. docker pushå‘½ä»¤æ¨é€é•œåƒåˆ°é•œåƒä»“åº“(DockerHubã€é˜¿é‡Œäº‘é•œåƒä»“åº“)

**æ¡ˆä¾‹è¯´æ˜ï¼š**
::code-group
```dockerfile[Dockerfile]
  FROM nginx:latest

  LABEL maintainer="ZiJun"
  COPY dist/ /usr/share/nginx/html/
  COPY default.conf /etc/nginx/default.conf

  EXPOSE 80
```
```nginx[nginx]
server {
  listen       80;
  #  server_name  localhost;

  access_log  /var/log/nginx/host.access.log  main;
  error_log  /var/log/nginx/error.log  error;

  location / {
      root   /usr/share/nginx/html;
      index  index.html index.htm;
      try_files $uri $uri/ /index.html;
  }
}
```
```bash[æ„å»ºé•œåƒ]
docker build -t test_nginx:v1 .
```
```bash[è¿è¡Œå®¹å™¨]
docker run -dp 8010:80 --name 'web-test' test_nginx:v1
```
::

### åŸºäºå·²æœ‰é•œåƒ(å®¹å™¨)åˆ›å»º
::alert{type="info"}
ğŸŒˆ æ ¸å¿ƒæ€æƒ³ï¼šé€šè¿‡docker commitå‘½ä»¤ï¼ŒåŸºäºä¸€ä¸ªå·²å­˜åœ¨çš„å®¹å™¨æ„å»ºå‡ºé•œåƒ
::

åˆ›å»ºImageå‘½ä»¤ä¸º:
```bash
// é€‰é¡¹: -m/--message æäº¤ä¿¡æ¯ -a/--author ä½œè€…ä¿¡æ¯ -p ç”Ÿæˆè¿‡ç¨‹ä¸­åœæ­¢å®¹å™¨è¿è¡Œ
docker commit [é€‰é¡¹] å®¹å™¨ID/åç§° [ä»“åº“åç§°[:æ ‡ç­¾]]
```

**æ¡ˆä¾‹è¯´æ˜** - åŸºäºç°æœ‰è¿è¡Œå®¹å™¨åˆ›å»ºé•œåƒ
```bash
# å…ˆæ‹‰å–å¯åŠ¨ä¸€ä¸ªå®¹å™¨
docker run -d -p 8010:80 docker/getting-started
# åŸºäºæ­¤å®¹å™¨åˆ›å»ºé•œåƒ
docker commit -m "add nginx" -a "ZiJun" 1a2b docker/getting-started:v2
```
**ä¼˜ç‚¹ï¼š**
   - ç®€å•å¿«æ·ï¼Œå¯æ„å»ºä¸´æ—¶çš„æµ‹è¯•é•œåƒ
   - å®¹å™¨è¢«å…¥ä¾µåï¼Œä½¿ç”¨docker commitï¼ŒåŸºäºè¢«å…¥ä¾µçš„å®¹å™¨æ„å»ºé•œåƒï¼Œä»è€Œä¿ç•™ç°åœºï¼Œæ–¹ä¾¿ä»¥åè¿½æº¯

**ç¼ºç‚¹ï¼š**
   - ä½¿ç”¨docker commitæ„å»ºçš„é•œåƒåŒ…å«äº†ç¼–è¯‘æ„å»ºã€å®‰è£…è½¯ä»¶ï¼Œä»¥åŠç¨‹åºè¿è¡Œäº§ç”Ÿçš„å¤§é‡æ— ç”¨æ–‡ä»¶ï¼Œè¿™ä¼šå¯¼è‡´é•œåƒä½“ç§¯å¾ˆå¤§ï¼Œéå¸¸è‡ƒè‚¿
   - ä½¿ç”¨docker commitæ„å»ºçš„é•œåƒä¼šä¸¢å¤±æ‰æ‰€æœ‰å¯¹è¯¥é•œåƒçš„æ“ä½œå†å²ï¼Œæ— æ³•è¿˜åŸé•œåƒçš„æ„å»ºè¿‡ç¨‹ï¼Œä¸åˆ©äºé•œåƒçš„ç»´æŠ¤



## æ„å»ºé•œåƒçš„åŸç†
å…¶å®è¿™2ç§æ„å»ºçš„åº•å±‚åŸç†æ˜¯ç›¸åŒçš„ï¼Œ éƒ½æ˜¯é€šè¿‡ä¸‹é¢ 3 ä¸ªæ­¥éª¤æ¥æ„å»ºé•œåƒï¼š
1. åŸºäºåŸé•œåƒï¼Œå¯åŠ¨ä¸€ä¸ª Docker å®¹å™¨ã€‚åœ¨å®¹å™¨ä¸­è¿›è¡Œä¸€äº›æ“ä½œï¼Œä¾‹å¦‚æ‰§è¡Œå‘½ä»¤ã€å®‰è£…æ–‡ä»¶ç­‰
2. ç”±è¿™äº›æ“ä½œäº§ç”Ÿçš„æ–‡ä»¶å˜æ›´éƒ½ä¼šè¢«è®°å½•åœ¨å®¹å™¨çš„å­˜å‚¨å±‚ä¸­
3. å°†å®¹å™¨å­˜å‚¨å±‚çš„å˜æ›´ commit åˆ°æ–°çš„é•œåƒå±‚ä¸­ï¼Œå¹¶æ·»åŠ åˆ°åŸé•œåƒä¸Š
